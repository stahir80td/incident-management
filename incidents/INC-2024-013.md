---
incident_id: INC-2024-013
severity: high
service: notification-service
date: 2024-04-16
---

# RabbitMQ Message Queue Backlog

## Summary
Notification service's RabbitMQ queue accumulated 500K+ messages due to downstream email service rate limiting, delaying notifications by several hours.

## Impact
- Average notification delay: 3.5 hours
- 547,000 messages in backlog
- Customer complaints about missing notifications
- Duration: 8 hours until queue cleared

## Timeline
- 08:00 UTC: Email service provider activated rate limiting
- 08:30 UTC: Queue depth alerts triggered
- 09:00 UTC: Backlog reached 100K messages
- 09:15 UTC: On-call engineer investigating
- 10:00 UTC: Identified email provider rate limits
- 10:30 UTC: Implemented batch sending logic
- 12:00 UTC: Scaled notification workers
- 16:00 UTC: Queue fully drained

## Root Cause
The email service provider imposed new rate limits of 1,000 emails/minute without prior notice. Our notification service was attempting to send at 3,000/minute, causing rejections and message requeuing. The service lacked backpressure handling.

## Resolution
1. Implemented respect for provider's rate limit headers
2. Added batch sending to maximize throughput within limits
3. Scaled worker count from 5 to 15
4. Implemented exponential backoff for failed sends
5. Added message priority queue for critical notifications

## Prevention
- Implement backpressure handling for all external service integrations
- Add queue depth monitoring with escalating alerts
- Create fallback notification channels (SMS, push)
- Establish communication channel with email provider for changes
- Implement message age monitoring and alerting
- Add circuit breaker pattern for downstream failures
- Create notification delivery SLA monitoring
