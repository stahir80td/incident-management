---
incident_id: INC-2024-016
severity: high
service: search-service
date: 2024-05-07
---

# Elasticsearch Cluster Split-Brain

## Summary
Network partition caused Elasticsearch cluster to split into two separate clusters, resulting in search inconsistencies and data conflicts.

## Impact
- Search results inconsistent for 35% of queries
- Some recent data not appearing in searches
- 2 hours to detect and resolve
- 4 hours of data reindexing required

## Timeline
- 14:20 UTC: Network partition between data centers
- 14:21 UTC: Cluster split into two masters
- 14:35 UTC: Search inconsistencies reported
- 14:45 UTC: Cluster health alerts triggered
- 15:00 UTC: Identified split-brain scenario
- 15:30 UTC: Network partition resolved
- 15:45 UTC: Cluster rejoined, conflicts detected
- 16:20 UTC: Began full reindex
- 18:20 UTC: Reindex completed, verified consistency

## Root Cause
A network switch failure caused intermittent packet loss between data centers. Elasticsearch's minimum_master_nodes was set to 2 in a 5-node cluster, allowing split-brain when the network partitioned into 3+2 nodes.

## Resolution
1. Resolved network partition
2. Corrected minimum_master_nodes to 3
3. Shutdown conflicting secondary cluster
4. Performed full cluster restart
5. Reindexed data to ensure consistency
6. Validated search results across all indices

## Prevention
- Set minimum_master_nodes to (N/2) + 1 for all clusters
- Deploy dedicated master nodes for cluster management
- Implement network path redundancy between data centers
- Add cluster state monitoring and alerts
- Create split-brain detection automation
- Document Elasticsearch cluster recovery procedures
- Conduct cluster failure simulations annually
