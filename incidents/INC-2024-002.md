---
incident_id: INC-2024-002
severity: critical
service: payment-processor
date: 2024-01-22
---

# Memory Leak in Payment Processing Service

## Summary
Payment processing service experienced gradual memory exhaustion leading to OOMKilled events and service restarts. Multiple payment transactions failed during the outage window.

## Impact
- 234 failed payment transactions
- $47,830 in temporarily blocked revenue
- Service restarted 6 times automatically
- Duration: 2 hours 15 minutes

## Timeline
- 09:15 UTC: Memory usage alerts triggered at 85%
- 09:30 UTC: First OOMKilled event, automatic restart
- 09:45 UTC: Memory patterns analyzed, suspected leak identified
- 10:20 UTC: Rolled back to previous stable version
- 11:30 UTC: Service stabilized, memory usage normal
- 13:45 UTC: Root cause confirmed in code review

## Root Cause
A recent code deployment introduced a memory leak in the payment webhook handler. The handler was creating new HTTP client instances for each webhook without properly disposing of them, causing gradual memory accumulation.

## Resolution
1. Rolled back to version 2.4.1 immediately
2. Implemented singleton HTTP client pattern
3. Added proper disposal in finally blocks
4. Deployed fix as version 2.4.3 after testing
5. Reprocessed failed transactions manually

## Prevention
- Mandate memory profiling in pre-production testing
- Add heap dump analysis to deployment pipeline
- Implement memory usage alerts at 70%, 85%, 95% thresholds
- Require load testing for payment-critical services
- Add memory leak detection to automated test suite
